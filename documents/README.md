# 用户手册

## 程序简介

该程序用于采集人眼在屏幕上的注视点信息

### 主程序 - main.py

1. 运行程序后，屏幕中出现一个被红圈包围的黑点，注视黑点并在任意位置点击鼠标后，圆点消失，原位置短暂出现数字1-4，在键盘上选择正确的数字才能出发数据保存，按下其他键则continue。
2. 当照片编号为21或22的正数倍时，应看向电脑屏幕外并点击鼠标。（具体操作按照程序提示操作即可）

## 操作流程

### 环境配置

打开IDE，在终端中运行脚本`bash run.sh`

### 运行代码

请依据`Condition.md`中的表格调整好光照环境后，运行`main.py`

### 后期检查

打开data文件夹中的照片进行查看，若发现存在‘面部不完整’或者‘眼睛部分有遮挡’的情况，请删除该照片和coordinate.txt中对应编号的数据，并重新采集

---

## 数据集介绍

### 数据集简介

- 这是一个基于日常光照条件下使用移动设备的眼动检测数据集。该数据集使用笔记本电脑顶部摄像头进行数据采集，旨在填补现有数据集在多样性和细节方面的不足。与市面上现有的数据集相比，该数据集对于光照条件的细分更加完善，并对头部姿态、设备距离、设备角度等影响因素进行了细分，大致情况分类如下图所示。因此，该数据集为眼动检测任务中y轴误差大、戴眼镜影响大、大角度性能差等技术难题提供了一个较好的解决方案。
- 本数据集共包含 9 种日常光照情况，每种光照情况根据坐姿端正、设备距离、设备倾斜角分为 12 种具体情况，共有 108 种具体情况。每位采集者在每种情况下采集 22 张（ 20 张注视屏幕内 + 2 张注视屏幕外）照片，一共有 2376 张照片和 9 个视频。预计收集40~50份数据。

### 光照条件介绍

|光照编号|光照情况|具体要求|
|:---:|:---:|:---:|
|1|白天室内正面光|0°~ +30°方向朝向 0.5 ~ 2m 距离的窗户|
|2|白天室内背面光|60°~ +120°方向朝向 0.5 ~ 2m 距离的窗户|
|3|白天室内侧面光|150°~ +180°方向朝向 0.5 ~ 2m 距离的窗户|
|4|白天室外任意光|在室外采集，阴晴不做具体限制|
|5|晚上室内顶灯光|室内正常明亮的顶灯光照，顶灯高度>2m|
|6|黑暗环境屏幕光|设备的屏幕亮度尽可能明亮|
|7|黑暗台灯正面光|台灯与设备的距离为 20 ~ 50cm，位于人的 0°~ +30° 方向|
|8|黑暗台灯侧面光|台灯与设备的距离为 20 ~ 50cm，位于人的 60°~ +120° 方向|
|9|黑暗环境外部光|被试者位于距打开的房间门大于 2m 的位置，外部灯光射入|

- 本数据集在采集量日常光照条件下数据的同时，使用激光笔测量被试者采集数据时的光照角度并记录

### 其他影响因素

|设备距离|设备倾斜角|头部姿态|
|:---:|:---:|:---:|
|70cm+|30°|Upright|
|45-48cm|15°|Not upright|
|32-35cm|||

- 设备距离：被试者肩膀处与移动设备屏幕的垂直距离
- 设备倾斜角：移动设备向后倾，与垂直方向之间的角度
- 头部姿态：
  - Upright：头部姿势端正
  - Not upright：头部姿势不端正，即歪头、俯视、仰视等姿态

### 数据集结构

    data
    ├─Photo
    │  └─1~2376.jpg
    ├─Video
    │  └─1~9.avi
    └─coordinate.txt

- `coordinate.txt`内包含数据信息：数据编号，采集者信息，光照情况编号，该照片在视频里的帧数，照片名称，X坐标，Y坐标
- 具体例子：如`coordinate.txt`中的数据`1585,Chen_glass,7,119,1585.jpg,930,597,`
  - 表示 采集者“Chen_glass” 在 编号为7的光照条件 下采集 照片1585.jpg , 该照片为 视频 7.avi 中的第119帧，该照片中的注视真值点为（930,597）


### 流程

- 被试者
  - 对电脑屏幕的长宽尺寸进行测量，得到每个像素点的尺寸
  - 对采集使用设备的摄像头进行相机标定，得到摄像头的内参和外参数
    - 使用平板或打印纸质黑白格（可以我们辅助标定）
  - 按照流程指引对周围的环境进行调整后采集数据集
    - 调整光照环境、设备距离、设备倾斜角、头部姿态，并测量当前光照角度
  - 对采集的数据进行检查，若发现存在‘面部不完整’或者‘眼睛部分有遮挡’的情况，删除对应数据，并重新采集
- 我
  - 对采集到的数据集进行检查和整理
  - 对数据集进行预处理归一化，得到相应旋转矩阵和归一化向量等
  - 将数据集整理成h5格式，并使用xgaze的代码进行训练

### 方法

- 可视化展示本数据集的头部姿态范围（、光照强度范围？）
- 比较本数据集中不同光照条件下的误差度数
- 测量本数据集模型在自己数据集上的误差度数
- 测量其他模型在本数据集上的误差度数，并与上面的结果进行对比
- 测量其他眼动模型在本数据集上的误差度数，并进行对比

### 背景

- Gaze360
  - 在非受控环境下，采集具有鲁棒性的3D视线跟踪数据集（具有照明和运动模糊的多样性）
  - 采集方法：使用360度全景相机，如右图所示。
  - 采集场景没有那么符合人们日常使用移动设备，没有规定具体情况条件划分，且数据集评估误差较大
- MPIIGaze
  - 来自15个采集者日常生活的213659张照片，覆盖了比较大范围的地点、时间、照明等环境变量
  - 采集方法：每隔十分钟要求采集者看向屏幕上20个未知的随机序列
  - 虽然包含大量日常使用场景，但没有数据集没有进行具体条件的严格限定，无法分析对每种环境变量对模型的影响。
- xGaze
  - 从110名参与者采集的大规模数据集（包含头部姿态、光照条件、性别、年龄、是否配戴眼镜等环境变量）
  - 采集方法：在实验室里进行光照条件控制，使用18个摄像头采集
  - 采集场景受限，不够日常，且环境变量的划分不够细致

### 后期模型评估

|Train\Test|本数据集|xGaze|MPIIGaze|Gaze360|Gaze Capture|
|:---:|:---:|:---:|:---:|:---:|:---:|
|本数据集||||||
|xGaze||--||||
|MPIIGaze|||--|||
|Gaze360||||--||
|Gaze Capture|||||--|